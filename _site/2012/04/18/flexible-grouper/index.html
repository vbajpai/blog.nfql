
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Flexible Grouper</title>
   <meta name="author" content="Vaibhav Bajpai" />
   <link href="http://feeds.feedburner.com/feedname" rel="alternate" title="your title" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">NFQL</a>
    </div>

    
<div id="post">
  <h1>Flexible Grouper</h1>
  <p class="meta">
    18 April 2012 
    
  </p>
  <p>The <code>grouper(...)</code> (1) call was plagued with hardcoded <code>uint32_t</code> type assumption on the field offset being used to make grouper rule comparisons. The function now internally calls <code>get_gtype(...)</code> to fall through a switch case to determine the type of the field offset at RUNTIME. Here is a snippet:</p>

<pre><code>struct grouper_type* get_gtype(uint64_t op) { 
  ...
  switch (op) {
  
    case RULE_S2_8:
      gtype-&gt;qsort_comp = comp_uint8_t;
      gtype-&gt;bsearch = bsearch_uint8_t;
      gtype-&gt;alloc_uniqresult = alloc_uniqresult_uint8_t;
      gtype-&gt;get_uniq_record = get_uniq_record_uint8_t;      
      gtype-&gt;dealloc_uniqresult = dealloc_uniqresult_uint8_t;

      break;
    case RULE_S2_16:
      ...
      break;
      
    case RULE_S2_32:
      ...
      break;
      
    case RULE_S2_64:
      ...
      break;
  }
  return gtype;
}</code></pre>

<p>At this point I do not think I have any assumptions on any field offset for any pipeline stage. As such experimentation on different style of queries should now work and is the next item on the list to investigate.</p>

<p>Resources:</p>

<p>(1) <a href='http://dl.dropbox.com/u/500389/mthesis/docs-engine/html/grouper_8h_source.html'><code>grouper</code> reference &#8594;</a></p>
</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>31 May 2012</span> &raquo; <a href="/2012/05/31/better-execution-engine-usage-on-run">Better Execution Engine Usage on Run</a></li>
    
      <li><span>19 May 2012</span> &raquo; <a href="/2012/05/19/v24-its-portable">v2.4: it's portable</a></li>
    
      <li><span>18 May 2012</span> &raquo; <a href="/2012/05/18/execution-engine-on-mac-os-x">Execution Engine on Mac OS X</a></li>
    
  </ul>
</div>




    <div class="footer">
      <div class="contact">
        <p>
          Vaibhav Bajpai<br />
          <a href='mailto:contact@vaibhavbajpai.com'>contact@vaibhavbajpai.com</a>
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/vbajpai/">github.com/vbajpai</a><br />
          <a href="http://facebook.com/vaibhavbajpai/">facebook.com/vaibhavbajpai</a><br />
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/feedname">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to RSS Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/vbajpai"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

