
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>Lazy Comparator Assignments</title>
   <meta name="author" content="Vaibhav Bajpai" />
   <link href="http://feeds.feedburner.com/feedname" rel="alternate" title="your title" type="application/atom+xml" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/tom/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Typekit -->
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

  <div class="site">
    <div class="title">
      <a href="/">NFQL</a>
    </div>

    
<div id="post">
  <h1>Lazy Comparator Assignments</h1>
  <p class="meta">
    18 April 2012 
    
  </p>
  <p>There are dedicated comparator functions for each <code>uintX_t</code> type of the field offset. Up until now, the choice for the function was made using a single function, <code>assign_fptr(...)</code> (1) which was called before the start of the pipeline to ensure all function pointers point to the right functions of each stage. Here is small snippet:</p>

<pre><code>assign_fptr(struct flowquery *fquery) {

  for (int i = 0; i &lt; fquery-&gt;num_branches; i++) {

    struct branch* branch = fquery-&gt;branchset[i];    
    
    /* for loop for the filter */
    for (int j = 0; j &lt; branch-&gt;num_filter_rules; j++) {…}
    
    /* for loop for the grouper */
    for (int j = 0; j &lt; branch-&gt;num_grouper_rules; j++) {…}    
    
    /* for loop for the group-aggregation */
    for (int j = 0; j &lt; branch-&gt;num_aggr_rules; j++) {…}
    
    /* for loop for the group-filter */
    for (int j = 0; j &lt; branch-&gt;num_gfilter_rules; j++) {…}	
  }
}</code></pre>

<p>This function is quite computationally expensive, since it falls through a HUGE switch statement to determine the function of right type. It is not guaranteed that given the type of the query and trace, the program will eventually go through each stage of the pipeline. It is also possible that the program exits before, because there is nothing more for the next stage to compute. As such the function pointers should be SET only from within the stage for the current stage. Here is a snippet:</p>

<pre><code>assign_filter_func(struct filter_rule* const frule) {...}
assign_grouper_func(struct grouper_rule* const grule) {...}  
assign_aggr_func(struct aggr_rule* const arule) {...}
assign_gfilter_func(struct gfilter_rule* const gfrule) {...}
assign_merger_func(struct merger_rule* const mrule) {...}</code></pre>

<p>Each of these functions are called from their respective stages just before when the comparison is required to be performed. As a result, we save the computation time wasted in setting the function pointer for stage X if X is never executed.</p>

<p>Resources:</p>

<p>(1) <a href='http://dl.dropbox.com/u/500389/mthesis/docs-engine/html/auto__assign_8c.html'><code>auto_assign</code> reference &#8594;</a></p>
</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>31 May 2012</span> &raquo; <a href="/2012/05/31/better-execution-engine-usage-on-run">Better Execution Engine Usage on Run</a></li>
    
      <li><span>19 May 2012</span> &raquo; <a href="/2012/05/19/v24-its-portable">v2.4: it's portable</a></li>
    
      <li><span>18 May 2012</span> &raquo; <a href="/2012/05/18/execution-engine-on-mac-os-x">Execution Engine on Mac OS X</a></li>
    
  </ul>
</div>




    <div class="footer">
      <div class="contact">
        <p>
          Vaibhav Bajpai<br />
          <a href='mailto:contact@vaibhavbajpai.com'>contact@vaibhavbajpai.com</a>
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/vbajpai/">github.com/vbajpai</a><br />
          <a href="http://facebook.com/vaibhavbajpai/">facebook.com/vaibhavbajpai</a><br />
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/feedname">
          <img src="/assets/themes/tom/images/rss.png" alt="Subscribe to RSS Feed" />
        </a>
      </div>
    </div>
  </div>
  <a href="http://github.com/vbajpai"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

  
</body>
</html>

